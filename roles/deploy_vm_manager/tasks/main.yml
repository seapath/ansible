# Copyright (C) 2024 RTE
# SPDX-License-Identifier: Apache-2.0

---
- name: Install pip
  ansible.builtin.apt:
    name: "python3-pip"
    update_cache: yes
    cache_valid_time: 3600
- name: Synchronization of src vm_manager on the control machine to dest on the remote hosts
  ansible.posix.synchronize:
    src: vm_manager
    dest: /tmp/src
    rsync_opts:
      - "--chown=root:root"
- name: Install vm_manager
  command:
    cmd: /usr/bin/pip install --root-user-action=ignore --prefix=/usr/ .
    chdir: /tmp/src/vm_manager
- name: Create a symbolic link
  ansible.builtin.file:
    src: /usr/local/bin/vm_manager_cmd
    dest: /usr/local/bin/vm-mgr
    state: link
