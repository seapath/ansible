# Copyright (C) 2021, RTE (http://www.rte-france.com)
# SPDX-License-Identifier: Apache-2.0
---

systemd_networkd_network_custom: "{{ custom_network | default([]) }}"
systemd_networkd_netdev_custom: "{{ custom_netdev | default([]) }}"

wired_systemd_networkd_netdev:
  00-br0:
    - NetDev:
        - Name: "br0"
        - Kind: "bridge"

wired_systemd_networkd_network:
  01-br0:
    - Match:
        - Name: "br0"
    - Network:
        - Gateway: "{{ gateway_addr }}"
        - Address: "{{ ip_addr }}/{{ subnet | default(24) }}"
  01-wired:
    - Match:
        - Name: "{{ network_interface }}"
    - Network: "{{ [ {'Bridge': 'br0'} ] + extra_network_config | default([]) }}"

systemd_networkd_netdev_nocluster: "{{ wired_systemd_networkd_netdev | combine(systemd_networkd_netdev_custom) }}"
systemd_networkd_network_nocluster: "{{ wired_systemd_networkd_network | combine(systemd_networkd_network_custom) }}"

team0_systemd_networkd_network:
  00-team0:
    - Match:
        - Name: "team0"
    - Network:
        - Address: "{{ cluster_ip_addr|default('0') }}/{{ subnet | default(24) }}"
  00-team0_0:
    - Match:
        - Name: "{{ team0_0|default('0') }}"
    - Link:
        - MTUBytes: 1800
  00-team0_1:
    - Match:
        - Name: "{{ team0_1|default('0') }}"
    - Link:
        - MTUBytes: 1800

systemd_networkd_network: "{% if cluster_ip_addr is defined %}{{ systemd_networkd_network_nocluster|combine(team0_systemd_networkd_network) }}{% else %}{{ systemd_networkd_network_nocluster}}{% endif %}"
systemd_networkd_netdev: "{{ systemd_networkd_netdev_nocluster }}"
