# Copyright (C) 2022, RTE (http://www.rte-france.com)
# SPDX-License-Identifier: Apache-2.0

---
- name: Deploy Cukinia's tests
  hosts: cluster_machines
  tasks:
    - name: Copy Cukinia's tests
      copy:
        src: ../src/cukinia-tests/cukinia
        dest: /etc/
    - name: Create /usr/share/cukinia/includes
      file:
        path: /usr/share/cukinia/includes
        state: directory
        owner: root
        group: root
        mode: 0755
    - name: Copy Cukinia's includes
      copy:
        src: ../src/cukinia-tests/includes/kernel_config_functions
        dest: /usr/share/cukinia/includes/kernel_config_functions
    - name: Create /usr/share/testdata
      file:
        path: /usr/share/testdata
        state: directory
        owner: root
        group: root
        mode: 0755
    - name: Copy vm.xml
      copy:
        src: ../src/debian/vm_manager/vm_manager/testdata/vm.xml
        dest: /usr/share/testdata
    - name: Copy wrong_vm_config.xml
      copy:
        src: ../src/debian/vm_manager/vm_manager/testdata/wrong_vm_config.xml
        dest: /usr/share/testdata


- name: Create /etc/cukinia.conf for observers
  hosts: observers
  tasks:
    - name: Create a symlink cukinia.conf to cukinia-observer.conf
      file:
        src: /etc/cukinia/cukinia-observer.conf
        dest: /etc/cukinia/cukinia.conf
        state: link

- name: Create /etc/cukinia.conf for hypervisors
  hosts: hypervisors
  tasks:
    - name: Create a symlink cukinia.conf to cukinia-hypervisor.conf
      file:
        src: /etc/cukinia/cukinia-hypervisor.conf
        dest: /etc/cukinia/cukinia.conf
        state: link
